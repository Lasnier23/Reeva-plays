<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>For Reeva ‚ù§Ô∏è</title>

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #ff9a9e, #fad0c4);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100dvh;
  width: 100dvw;
  overflow: hidden;
  touch-action: manipulation;
}

.screen {
  text-align: center;
  padding: 20px;
  width: 95%;
  max-width: 480px;
}

h1, p {
  color: white;
}

canvas {
  background: #111;
  border-radius: 12px;
  margin-top: 10px;
  width: 100%;
  height: 70dvh;
  max-height: 520px;
}

.btn {
  padding: 14px 26px;
  border: none;
  border-radius: 30px;
  font-size: 18px;
  cursor: pointer;
  margin: 10px;
}

.yes {
  background: #ff4b7d;
  color: white;
}

.no {
  background: white;
}

.hidden { display:none; }

.arrow-btn {
  font-size: 24px;
  padding: 14px 24px;
  border-radius: 12px;
  border: none;
  margin: 6px;
  background: white;
}

.celebration {
  font-size: 30px;
  color: white;
}
</style>
</head>

<body>

<div class="screen" id="start">
<h1>Hi Reeva ‚ù§Ô∏è</h1>
<p>Clear just ONE line to unlock something special ‚ú®</p>
<button class="btn yes" onclick="startGame()">Start</button>
</div>

<div class="screen hidden" id="game">
<h1>Make 1 Full Row üíï</h1>
<canvas id="board"></canvas>

<div>
<button class="arrow-btn" onclick="move(-1)">‚¨ÖÔ∏è</button>
<button class="arrow-btn" onclick="move(1)">‚û°Ô∏è</button>
</div>

<p style="color:white; font-size:14px;">Tap the screen to rotate blocks üòâ</p>
</div>

<div class="screen hidden" id="proposal">
<h1>Reeva, will you be my Valentine? ‚ù§Ô∏è</h1>
<button class="btn yes" onclick="celebrate()">YES üíò</button>
<button class="btn no" id="noBtn">No</button>
</div>

<div class="screen hidden" id="celebration">
<div class="celebration">üéâ Reeva and Sparsh are now a thing! üéâ</div>
<p style="color:white; font-size:20px;">Best Valentine ever üíñ</p>
</div>

<audio id="bgMusic" loop>
<source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=romantic-background-112191.mp3" type="audio/mp3">
</audio>

<audio id="winMusic">
<source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0c7443c.mp3?filename=success-fanfare-trumpets-6185.mp3" type="audio/mp3">
</audio>

<script>
const canvas = document.getElementById('board');
const ctx = canvas.getContext('2d');
const COLS = 10;
const ROWS = 20;
const SIZE = 20;

let board;
let piece;
let cleared = false;

// Easier pieces
const pieces = [
  [[1,1,1,1]],
  [[1,1],[1,1]],
  [[1,1,1]]
];

function createBoard(){
  board = Array.from({length: ROWS}, ()=>Array(COLS).fill(0));
}

function newPiece(){
  const shape = JSON.parse(JSON.stringify(pieces[Math.floor(Math.random()*pieces.length)]));
  piece = {
    shape,
    x: Math.floor(COLS/2) - Math.ceil(shape[0].length/2),
    y: 0
  };
}

function drawCell(x,y,color='#00e5ff'){
  ctx.fillStyle = color;
  ctx.fillRect(x*SIZE,y*SIZE,SIZE-1,SIZE-1);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(board[r][c]) drawCell(c,r,'#ff4b7d');
    }
  }

  piece.shape.forEach((row,r)=>{
    row.forEach((val,c)=>{
      if(val) drawCell(piece.x+c,piece.y+r);
    });
  });
}

function collision(dx,dy,shape=piece.shape){
  return shape.some((row,r)=>
    row.some((val,c)=>{
      if(!val) return false;
      let newX = piece.x + c + dx;
      let newY = piece.y + r + dy;
      return newX<0 || newX>=COLS || newY>=ROWS || (board[newY] && board[newY][newX]);
    })
  );
}

function merge(){
  piece.shape.forEach((row,r)=>{
    row.forEach((val,c)=>{
      if(val) board[piece.y+r][piece.x+c] = 1;
    });
  });
}

function rotate(){
  const rotated = piece.shape[0].map((_,i)=>piece.shape.map(row=>row[i]).reverse());
  if(!collision(0,0,rotated)){
    piece.shape = rotated;
    draw();
  }
}

function clearLines(){
  for(let r=ROWS-1;r>=0;r--){
    if(board[r].every(cell=>cell)){
      cleared = true;
      setTimeout(endGame,500);
      return;
    }
  }
}

function drop(){
  if(!collision(0,1)){
    piece.y++;
  } else {
    merge();
    clearLines();
    if(!cleared){
      newPiece();
      if(collision(0,0)) createBoard();
    }
  }
  draw();
  if(!cleared) setTimeout(drop, 180);
}

function move(dir){
  if(!collision(dir,0)){
    piece.x += dir;
    draw();
  }
}

// Prevent zoom on double tap
let lastTouchEnd = 0;
document.addEventListener('touchend', function (event) {
  const now = (new Date()).getTime();
  if (now - lastTouchEnd <= 300) {
    event.preventDefault();
  }
  lastTouchEnd = now;
}, false);

canvas.addEventListener('touchstart', rotate);
canvas.addEventListener('click', rotate);

window.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft') move(-1);
  if(e.key==='ArrowRight') move(1);
  if(e.key==='ArrowUp') rotate();
});

function startGame(){
  document.getElementById('start').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
  document.getElementById('bgMusic').play();

  createBoard();
  newPiece();
  drop();
}

function endGame(){
  document.getElementById('game').classList.add('hidden');
  document.getElementById('proposal').classList.remove('hidden');
}

const noBtn = document.getElementById('noBtn');
noBtn.addEventListener('mouseover',()=>{
  noBtn.style.position='absolute';
  noBtn.style.top=Math.random()*80+'%';
  noBtn.style.left=Math.random()*80+'%';
});

function celebrate(){
  document.getElementById('proposal').classList.add('hidden');
  document.getElementById('celebration').classList.remove('hidden');
  document.getElementById('winMusic').play();
}
</script>

</body>
</html>
